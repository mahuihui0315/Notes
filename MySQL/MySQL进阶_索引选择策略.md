# MySQL进阶_索引选择策略
MySQL的索引是由优化器来选择出最适合的一个，但是优化器有时也会选择出不是最适合的索引

## 优化器的逻辑
优化器会根据扫描行数、是否使用临时表、是否排序等因素来进行综合判断

### 如何判断扫描行数
MySQL开始之前不知道满足条件的记录到底有多少，只能通过统计信息来判断，而统计信息就是索引的区分度即一个索引上不同值的个数，称之为基数cardinality。可以使用show index from tablename来查看

### 索引如何获取基数
MySQL通过采样统计的方法获取对应索引的基数。即选择N个页面，统计每个页面的不同值得到一个平均值，然后乘以全部页面数获取基数

索引的统计信息也会随着表的更新而更新，当数据行数跟新超过1/M时，就会重新做一次索引统计

### 不同索引的隐藏扫描行数
虽然有了扫描行数，但是也不能保证优化器一定会选择行数少索引，因为不同索引之间也是有差别的，比如主键索引和普通索引

主键索引的存储值为数据本身，因此查询到符合条件的数据不会执行额外的动作，但是普通索引的存储值为主键，因此需要通过主键索引获取数据，而这个动作也会被优化器计算进去

若是由于不准确的索引统计引起的选择错误可以通过analyze table tablename来重新统计索引基数来解决

## 索引选择异常和处理方法
1. 使用force index(indexname)强制修改索引

缺点：如果改变了索引，sql语句也需要改变；如果有迁移数据库的需要也可能会出现语法不兼容

2. 修改sql语句，引导MySQL选择我们希望的索引

缺点：不通用，只有特点的场合可以使用

3. 新建一个更合适的索引或者删除误用的索引

缺点：新建更优秀的索引存在一定的难度，删除索引也是需要特定的场合

